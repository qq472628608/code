function sendAjax(e,t,a,n){var i=new XMLHttpRequest;i.open(e,t,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){4==i.readyState&&200==i.status?n&&n.call(this,i.responseText):4==i.readyState&&200!=i.status&&(window.location.href="404.html")},a?i.send(a):i.send()}function link(e){sendAjax("get","/currentUserId",null,function(){arguments[0]?window.location.href=e+"?id="+arguments[0]:(alert("请登录"),window.location.href="index.html")})}function createArticle(e){var t=JSON.parse(e);if(t.length>0)for(var a=t.length-1;a>=0;a--){var n=document.createElement("div");n.className="article",n.innerHTML='<input type="hidden" name="id" value="'+t[a].id+'"><div class="article_image"><a class="a_article" href="article.html?id='+t[a].id+'"><img class="image" src="'+t[a].image+'"></a></div><div class="article_summary"><a class="title" href="article.html?id='+t[a].id+'">'+t[a].title+'</a><a class="author" href="pinfo.html?id=1">Posted by：fan jia wei</a><p class="summary">'+t[a].summary+'</p><a class="more" href="article.html?id='+t[a].id+'">View More</a><div class="tag"><ul class="tag_ul"><li class="tag_li"><a class="tag_a1" href="javascript:void(0);"><i class="'+t[a].tag1+'"></i>&nbsp;收藏</a></li><li class="tag_li"><a class="tag_a2" href="javascript:void(0);"><i class="fa fa-heart-o"></i>&nbsp;<span>'+t[a].love+'</span>&nbsp;喜欢</a></li><li class="tag_li"><a class="tag_a3" href="article.html#comment?id='+t[a].id+'"><i class="fa fa-comments-o"></i>&nbsp;评论</a></li></ul></div>',left_list.appendChild(n)}}function getArticle(e,t){for(var a=1;a<=t;a++)e=e.parentNode;return e}function createComment(e){var t=JSON.parse(e);if(t.length>0)for(var a=0;a<t.length;a++){var n=document.createElement("div");n.className="comment";var i=t[a].text;i.length>18&&(i=i.substring(0,18)+"......"),n.innerHTML='<input type="hidden" name="id" value="'+t[a].id+'"><div class="comment_head"><a class="a_visitor" href="pinfo.html?id='+t[a].user.id+'"><img class="head" src="'+t[a].user.image+'"></a></div><div class="comment_content"><a class="a_comment" href="article.html?id='+t[a].article.id+'"><span class="content">'+i+'</span></a><p class="content_time">'+t[a].time+"</p></div>",comments.appendChild(n)}}function find(e){sendAjax("get","/getArticlesByKind?kindSn="+e,null,function(){arguments[0]&&(document.querySelector(".left_list").innerHTML="",createArticle(arguments[0]))})}document.querySelector(".link_logo_container img").onclick=function(){window.location.href="index.html"};var left_list=document.querySelector(".left_list");sendAjax("get","/getArticles",null,function(){createArticle(arguments[0]);var e=document.querySelectorAll(".tag_a1");if(null!=e)for(var t in e)e[t].onclick=function(){var e=this;sendAjax("get","/currentUserId",null,function(){if(arguments[0]){var t=getArticle(e,5).querySelector("input[name='id']").value,a=e.querySelector("i").className,n="userid="+arguments[0]+"&articleid="+t;"fa fa-tags"==a?sendAjax("post","/collect",n,function(){e.querySelector("i").className="fa fa-star"}):sendAjax("post","/removeCollection",n,function(){e.querySelector("i").className="fa fa-tags"})}else alert("请登录"),window.location.href="index.html"})};var a=document.querySelectorAll(".tag_a2");if(null!=a)for(var t in a)a[t].onclick=function(){var e=this,t=getArticle(this,5).querySelector("input[name='id']").value,a=this.querySelector("i");if("fa fa-heart-o"==a.className){var n="isAdd=true&id="+t;sendAjax("post","/love",n,function(){arguments[0]&&(e.querySelector("span").innerHTML=arguments[0],e.querySelector("i").className="fa fa-heart")})}else{n="isAdd=false&id="+t;sendAjax("post","/love",n,function(){arguments[0]&&(e.querySelector("span").innerHTML=arguments[0],e.querySelector("i").className="fa fa-heart-o")})}}}),document.querySelector(".a_search").onclick=function(){var e=document.querySelector(".search_input").value;left_list.innerHTML="";var t="keywords="+e;sendAjax("post","/searchArticles",t,function(){arguments[0]&&createArticle(arguments[0])})};var comments=document.querySelector(".recent_comments");sendAjax("get","/getFourComment",null,function(){arguments[0]&&createComment(arguments[0])});var url=window.location.search,kindSn=url.substring(url.lastIndexOf("=")+1,url.length);""!=kindSn&&find(kindSn);