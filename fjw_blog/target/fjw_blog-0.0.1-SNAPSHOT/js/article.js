function sendAjax(e,t,n,a){var i=new XMLHttpRequest;i.open(e,t,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){4==i.readyState&&200==i.status?a&&a.call(this,i.responseText):4==i.readyState&&200!=i.status&&(window.location.href="404.html")},n?i.send(n):i.send()}function dataAjax(e,t,n){var a=new XMLHttpRequest;a.open("post",e,!0),a.onreadystatechange=function(){4==a.readyState&&200==a.status&&n&&n.call(this,a.responseText)},a.send(t)}function link(e){sendAjax("get","/currentUserId",null,function(){arguments[0]?window.location.href=e+"?id="+arguments[0]:(alert("请登录"),window.location.href="index.html")})}function updateArticle(){window.location.href="/updateArticle?articleid="+id}function createComment(e){var t=JSON.parse(e);if(t.length>0)for(var n in t){var a=document.createElement("div"),i=t[n].text;i.length>18&&(i=i.substring(0,18)+"......"),a.className="comment",a.innerHTML='<input type="hidden" name="id" value='+t[n].id+'><div class="comment_head"><a class="a_visitor" href="pinfo.html?id='+t[n].user.id+'"><img class="head" src="'+t[n].user.image+'"></a></div><div class="comment_content"><a class="a_comment" href="article.html?id='+t[n].article.id+'"><span class="content">'+i+'</span></a><p class="content_time">'+t[n].time+"</p></div>",comments.appendChild(a)}}function find(e){window.location.href="home.html?kindSn="+e}function listComment(e){var t=JSON.parse(e),n=document.querySelector(".list_ul");if(t.length>0)for(var a in t)if(t[a].parent){r=document.querySelector(".list_ul .put_comment input[value='"+t[a].parent.id+"']").parentNode.parentNode;var i=document.createElement("div");i.className="reply_comment",i.innerHTML='<ul><input type="hidden" name="id" value="'+t[a].id+'"><li><a href="pinfo.html?id='+t[a].user.id+'"><img src="'+t[a].user.image+'"></a></li><div class="put_body"><div class="put_user"><i class="fa fa-user-o"></i>&nbsp;Posted by<a class="a_put_user" href="pinfo.html?id='+t[a].user.id+'">'+t[a].user.name+'</a></div><div class="put_content">'+t[a].text+'</div><div class="put_time"> '+t[a].time+"</div></div></ul>",r.appendChild(i)}else{var r=document.createElement("li");r.innerHTML='<div class="put_comment"><input type="hidden" name="id" value="'+t[a].id+'"><ul><li><a href="pinfo.html?id='+t[a].user.id+'"><img src="'+t[a].user.image+'"></a></li><div class="put_body"><div class="put_user"><i class="fa fa-user-o"></i>&nbsp;Posted by：<a class="a_put_user" href="pinfo.html?id='+t[a].user.id+'">'+t[a].user.name+'</a></div><div class="put_content">'+t[a].text+'</div><div class="put_time">'+t[a].time+'</div><div class="reply_btn"><a href="javascript:void(0);">&nbsp;&nbsp;&nbsp;回复</a></div></div></ul><div class="edit_reply"><div contenteditable="true" class="edit_content"></div><div class="edit_button"><button>提交&nbsp;<i class="fa fa-arrow-right"></i></button></div></div></div>',n.appendChild(r)}}function currentComment(){sendAjax("get","/listComment?articleid="+id,null,function(){if(arguments[0]){listComment(arguments[0]);var e=document.querySelectorAll(".reply_btn");for(var t in e)e[t].onclick=function(){var e=this.parentNode.parentNode.parentNode.querySelector(".edit_reply");e.setAttribute("style","display:block;")};var n=document.querySelectorAll(".edit_button button");for(var t in n)n[t].onclick=function(){var e=this,t=this.parentNode.parentNode.className,n=this.parentNode.parentNode.querySelector(".edit_content").innerText,a=n.replace(/</g,"&lt;"),i=a.replace(/>/g,"&gt;"),r=new FormData;if(r.append("text",i),r.append("articleid",id),"edit"==t)dataAjax("/saveComment",r,function(){document.querySelector(".edit_content").innerText="",document.querySelector(".list_ul").innerHTML="",currentComment()});else{var l=e.parentNode.parentNode.parentNode.querySelector("input").value;r.append("parentid",l),dataAjax("/saveComment",r,function(){var t=e.parentNode.parentNode;t.setAttribute("style","display:none;"),document.querySelector(".edit_content").innerText="",document.querySelector(".list_ul").innerHTML="",currentComment()})}}}})}var url=window.location.search,id=url.substring(url.lastIndexOf("=")+1,url.length);id||(window.location.href="404.html"),document.querySelector(".link_logo_container img").onclick=function(){window.location.href="index.html"},sendAjax("get","/getArticle?id="+id,null,function(){if(arguments[0]){var e=JSON.parse(arguments[0]);document.querySelector(".article_title").innerHTML=e.title;var t=e.text,n=t.replace(/&lt;/g,"<"),a=n.replace(/&gt;/g,">"),i=document.querySelector(".text");i.innerHTML=a,document.querySelector(".tag_a1 i").className=e.tag1,Prism.highlightAll()}}),sendAjax("get","/currentUserId",null,function(){if(1==arguments[0]){var e=document.createElement("li");e.className="tag_li",e.innerHTML='<a class="tag_a3" href="javascript:updateArticle();">修改</a>',document.querySelector(".tag_ul").appendChild(e)}});var tag_a1=document.querySelector(".tag_a1");tag_a1.onclick=function(){var e=this;sendAjax("get","/currentUserId",null,function(){if(arguments[0]){var t=e.querySelector("i").className,n="userid="+arguments[0]+"&articleid="+id;"fa fa-tags"==t?sendAjax("post","/collect",n,function(){e.querySelector("i").className="fa fa-star"}):sendAjax("post","/removeCollection",n,function(){e.querySelector("i").className="fa fa-tags"})}else alert("请登录"),window.location.href="index.html"})};var tag_a2=document.querySelectorAll(".tag_a2");null!=tag_a2&&(tag_a2.onclick=function(){var e=this,t=this.querySelector("i");if("fa fa-heart-o"==t.className){var n="isAdd=true&articleid="+id;sendAjax("post","/love",n,function(){arguments[0]&&(e.querySelector("span").innerHTML=arguments[0],e.querySelector("i").className="fa fa-heart")})}else{n="isAdd=false&articleid="+id;sendAjax("post","/love",n,function(){arguments[0]&&(e.querySelector("span").innerHTML=arguments[0],e.querySelector("i").className="fa fa-heart-o")})}});var comments=document.querySelector(".recent_comments");sendAjax("get","/getFourComment",null,function(){arguments[0]&&createComment(arguments[0])}),currentComment();